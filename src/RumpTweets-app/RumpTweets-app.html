<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-grid/iron-grid.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.js"></script>
<link rel="import" href="shared-styles.html">
<dom-module id="RumpTweets-app">
  <template>
    <style include="shared-styles">
       :host {
        display: block;
        height: 100%;
      }
      
      .whiteColor {
        background: white;
      }
      
      .americanFlagRed {
        background: #b22234;
        height: 100%;
      }
      
      iron-grid {
        height: 100%;
      }
      
      #twitterCard {
        width: 100%;
        background: white;
      }
      
      .tweet {
        width: 100%;
        padding: 20px;
      }
      
      .tweet_bottom_icons {
        --iron-image-width: 17px;
      }
      
      #shareImage-button {
        height: 40px;
        background: #2AA4EF;
        color: white;
      }
      
      paper-textarea {
        --paper-input-container-color: white;
        --paper-input-container-focus-color: white;
        --paper-input-container-label: {
          color: grey;
        }
      }
      .baner_Image{
        --iron-image-width: 100%;
      }
      #donaldHandUp_Image{
        width: 100%;
        margin-top:100px;
        /*padding-top: 40px;
        padding-left: 40px;
        padding-right: 40px;*/
      }
      /*#mainContent{
        background: red;
      }*/
      .greeting{
        font-size: 26pt;
        font-weight: 300;
      }
    </style>
    <iron-grid xs-max-width="300" s-max-width="650">
      <!--<div class=" s0 m2 americanFlagRed"></div>-->
      <div  class="offset-m2 s12 m8 whiteColor" style="padding-left:0px; padding-right:0px;">
        <iron-image class="baner_Image" style="margin-left:auto; margin-right: auto;" src="../../images/png/banner.png" preload ></iron-image>
        <!------Start of twitter stuff------>
        
        <div id="twitterCard" >
          <div class="permalink-inner permalink-tweet-container">
            <iron-grid>
              <div class="s12 offset-m2 m8 ">
                <div class="greeting">
                  <p style="margin-top:20px;">Congratulations, Mr. President. </p>
                  <p style="margin-top: 30px;">You are now the most powerful man in the world. Before you use this tool, <span style="font-weight:400;">you must know that your voice, your words, 
                    and your actions can change our world for the better</span> or for the worse. 
                    So please use it with the care we expect from your office. </p>
                </div>       
                <div class=" card tweet permalink-tweet js-actionable-user js-actionable-tweet js-original-tweet with-social-proof logged-in js-initial-focus  focus"
                  data-associated-tweet-id="822504142178500608" data-tweet-id="822504142178500608" data-item-id="822504142178500608"
                  data-permalink-path="/realDonaldTrump/status/822504142178500608" data-conversation-id="822504142178500608"
                  data-tweet-nonce="822504142178500608-152725ae-1a35-4132-9d78-db3756b852e7" data-screen-name="realDonaldTrump"
                  data-name="Donald J. Trump" data-user-id="25073877" data-you-follow="false" data-follows-you="false" data-you-block="false"
                  data-disclosure-type="" tabindex="0">
                  <div class="content clearfix">
                    <div class="permalink-header">
                      <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" data-user-id="25073877">
                        <img class="avatar js-action-profile-avatar" src="../../images/png/djt_headshot.jpg" alt="">
                        <strong class="fullname js-action-profile-name show-popup-with-id" data-aria-label-part="">Donald J. Trump<iron-image class="Icon" style="position: absolute; margin-left:4px;" src="../../images/png/ic_verify.png" ></strong>
                        <span>&rlm;</span><span class="username js-action-profile-name" data-aria-label-part=""><s>@</s><b>realDonaldTrump</b></span>
                      </a>
                      <!--<small class="time">
                          <a  class="tweet-timestamp js-permalink js-nav js-tooltip" title="10:00 AM - 20 Jan 2017" data-conversation-id="822504142178500608"><span class="_timestamp js-short-timestamp js-relative-timestamp" data-time="1484935243" data-time-ms="1484935243000" data-long-form="true" aria-hidden="true">8h</span><span class="u-hiddenVisually" data-aria-label-part="last">8 hours ago</span></a>
                        </small>-->
                      <div class="follow-bar">
                        <div class="user-actions btn-group not-following not-muting  " data-user-id="25073877" data-screen-name="realDonaldTrump"
                          data-name="Donald J. Trump" data-protected="false">
                          <button class="user-actions-follow-button js-follow-btn follow-button btn" type="button">
                          <span class="button-text follow-text" style="margin-top:4px;">
                           <iron-image class="Icon" style="margin-bottom:3px" src="../../images/png/follow_icon.png" ></iron-image>Follow 
                            
                          </span>
                          
                        </button>
                      </div>
                    </div>
                  </div>
              </div>
              <div class="js-tweet-text-container">
                <paper-textarea id="input-textArea" label="Click to start typing..."></paper-textarea>
              </div>
              <div class="js-tweet-details-fixer tweet-details-fixer">
                <div class="js-machine-translated-tweet-container"></div>
                <div class="js-tweet-stats-container tweet-stats-container">
                  <ul class="stats" aria-label="Retweeted and favorited by">
                    <li class="js-stat-count js-stat-retweets stat-count" aria-hidden="true">
                      <a tabindex="0" role="button" data-tweet-stat-count="10433" data-compact-localized-count="10K" class="request-retweeted-popup"
                        data-activity-popup-title="10,433 retweets">
                        Retweets <strong>10,433</strong>
                        </a>
                    </li>
                    <li class="js-stat-count js-stat-favorites stat-count" aria-hidden="true">
                      <a tabindex="0" role="button" data-tweet-stat-count="54820" data-compact-localized-count="55K" class="request-favorited-popup"
                        data-activity-popup-title="54,820 likes">
                        Likes <strong>54,820</strong>
                        </a>
                    </li>
                    <li class="avatar-row js-face-pile-container">
                      <a class="js-profile-popup-actionable js-tooltip" data-user-id="930429612" original-title="Robert Golden" title="Robert Golden"rel="noopener">
                        <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_1.jpeg" alt="Robert Golden">
                      </a>
                        <a class="js-profile-popup-actionable js-tooltip" data-user-id="3084231070" original-title="Wanda Brewington" title="Wanda Brewington"
                          rel="noopener">
                          <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_2.png" alt="Wanda Brewington">
                          </a>
                          <a class="js-profile-popup-actionable js-tooltip" data-user-id="755004241383751680" original-title="TrumpPepe2020" title="TrumpPepe2020"
                            rel="noopener">
                            <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_3.jpg" alt="TrumpPepe2020">
                            </a>
                            <a class="js-profile-popup-actionable js-tooltip" data-user-id="3303150538" original-title="Thomas Jon IV" title="Thomas Jon IV"
                              rel="noopener">
                              <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_4.jpg" alt="Thomas Jon IV">
                              </a>
                              <a class="js-profile-popup-actionable js-tooltip" data-user-id="3439191809" original-title="Zachary Lippincott" title="Zachary Lippincott"
                                rel="noopener">
                                <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_5.jpg" alt="Zachary Lippincott">
                                </a>
                                <a class="js-profile-popup-actionable js-tooltip" data-user-id="758491129104834560" original-title="Hillary Diane" title="Hillary Diane"
                                  rel="noopener">
                                  <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_6.png" alt="Hillary Diane">
                                  </a>
                                  <a class="js-profile-popup-actionable js-tooltip" data-user-id="822447154182688768" original-title="Sandra Darby" title="Sandra Darby"
                                    rel="noopener">
                                    <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_7.png" alt="Sandra Darby">
                                    </a>
                                    <a class="js-profile-popup-actionable js-tooltip" data-user-id="818129288763351040" original-title="Patti Collis" title="Patti Collis"
                                      rel="noopener">
                                      <img class="avatar size24 js-user-profile-link" src="../../images/png/follower_8.png" alt="Patti Collis">
                                      </a>
                    </li>
                  </ul>
                </div>
                <div class="client-and-actions">
                  <span class="metadata">
                        <span>10:00 AM - 20 Jan 2017</span>
                  </span>
                </div>
              </div>
              <div class="stream-item-footer">
                <div class="ProfileTweet-actionCountList u-hiddenVisually">
                  <span class="ProfileTweet-action--reply u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="4775">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">4,775 replies</span>
                  </span>
                  </span>
                  <span class="ProfileTweet-action--retweet u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="10433">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">10,433 retweets</span>
                  </span>
                  </span>
                  <span class="ProfileTweet-action--favorite u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="54820">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">54,820 likes</span>
                  </span>
                  </span>
                </div>
                <div class="ProfileTweet-actionList js-actions buffer-inserted pocket-inserted" role="group" aria-label="Tweet actions">
                  <div class="ProfileTweet-action ProfileTweet-action--reply">
                    <button class="ProfileTweet-actionButton u-textUserColorHover js-actionButton js-actionReply" data-modal="ProfileTweet-reply"
                      type="button">
                      <div class="IconContainer js-tooltip" title="Reply">
                        <iron-image class="Icon tweet_bottom_icons" src="../../images/png/ic_replypng.png"></iron-image>
                        <span class="u-hiddenVisually">Reply</span>
                      </div>
                      <div class="IconTextContainer">
                        <span class="ProfileTweet-actionCount ">
                              <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">4.8K</span>
                        </span>
                      </div>
                      </button>
                  </div>
                  <div class="ProfileTweet-action ProfileTweet-action--retweet js-toggleState js-toggleRt">
                    <button class="ProfileTweet-actionButton  js-actionButton js-actionRetweet" data-modal="ProfileTweet-retweet" type="button">
                                      <div class="IconContainer js-tooltip" title="Retweet">
                                        <iron-image class="Icon tweet_bottom_icons" src="../../images/png/ic_retweetpng.png" ></iron-image>
                                        <span class="u-hiddenVisually">Retweet</span>
                                      </div>
                                        <div class="IconTextContainer">
                                          <span class="ProfileTweet-actionCount">
                                            <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">10K</span>
                                          </span>
                                        </div>
                                    </button>
                  </div>
                  <div class="ProfileTweet-action ProfileTweet-action--favorite js-toggleState">
                    <button class="ProfileTweet-actionButton js-actionButton js-actionFavorite" type="button">
                                      <div class="IconContainer js-tooltip" title="Like"></div>
                                        <div class="IconTextContainer">
                              <iron-image class="Icon tweet_bottom_icons" src="../../images/png/ic_likepng.png" ></iron-image>
                              <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">55K</span>
                          </div>
                      </button>
                  </div>
                </div>
              </div>
          </div>
        </div>
        </iron-grid>
        <iron-grid>
          <paper-button id="shareImage-button" on-tap="takePicture" raised class="offset-s3 s6">Share your fake tweet.</paper-button>
        </iron-grid>
          <iron-image id="donaldHandUp_Image" class="baner_Image" style="margin-left:auto; margin-right: auto; background: white;" src="../../images/png/donaldHandUp.png" ></iron-image>
      </div>
      
      </div>
      
      </div>
      <!--<div class="s0 m2 americanFlagRed"></div>-->
    </iron-grid>
  </template>
  <script>
    Polymer({

      is: 'RumpTweets-app',

      properties: {
        prop1: {
          type: String,
          value: 'RumpTweets-app',
        },
        user :{
          type:Object,
          value:{}
        }
      },

      ready: function () {
        var rootThis = this;
        var textArea = Polymer.dom(this.root).querySelector("#input-textArea");
        var donaldTrunpHandUp = Polymer.dom(this.root).querySelector("#donaldHandUp_Image");
        var imageContainer = donaldTrunpHandUp.getElementsByTagName("img");
        //console.log(imageContainer.getBoundingClientRect());
        setTimeout(function() {
            firebase.auth().signInAnonymously().catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // ...
          });

          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              // User is signed in.
              var isAnonymous = user.isAnonymous;
              var uid = user.uid;
              rootThis.user = user;
              console.log(rootThis.user);
              // ...
            } else {
              // User is signed out.
              // ...
            }
            // ...
          });
        }, 500);
        

      },

      takePicture: function () {
        var rootThis = this;
        var categorySection = Polymer.dom(this.root).querySelector('#twitterCard');
        var doucumentRootRef = this.root;
        //console.log(categorySection);
        html2canvas(categorySection, {
          onrendered: function (canvas) {
          
          canvas.toBlob(function(blob){
               // Create a root reference
            var storageRef = firebase.storage().ref();

            //get ref to new key
            var newPostKey = firebase.database().ref().child('Posts/'+rootThis.user.uid+'/').push().key;
            // Create a reference to were you want to store data
            var mountainImagesRef = storageRef.child('images/'+rootThis.user.uid+'/'+newPostKey+'trump_tweet.jpeg');

             var postData = {
              imgeUrl: mountainImagesRef.fullPath,
            };
            var updates = {};
            updates['/Posts/' + rootThis.user.uid + '/' + newPostKey] = postData;

            var file = blob // use the Blob or File API
            mountainImagesRef.put(file).then(function(snapshot) {
              console.log('Uploaded a blob or file!');
              firebase.database().ref().update(updates);
            });

          }, 'image/jpeg', 1);
            
          }
        });
      }

    });
  </script>
</dom-module>
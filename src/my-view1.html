<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-grid/iron-grid.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="styles/twitter-style.html">
<dom-module id="my-view1">
  <template>
    <style include="twitter-style">
       :host {
        display: block;
        height: 100%;
      }
      
      .whiteColor {
        background: white;
      }
      
      .americanFlagRed {
        background: #b22234;
        height: 100%;
      }
      
      iron-grid {
        height: 100%;
      }
      
      #twitterCard {
        width: 100%;
        background: white;
      }
      
      .tweet {
        width: 100%;
        padding: 20px;
      }
      
      .tweet_bottom_icons {
        --iron-image-width: 17px;
      }
      
      #shareImage-button {
        height: 40px;
        background: #2AA4EF;
        color: white;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        margin-top: 30px;
      }
      
      paper-textarea {
        --paper-input-container-color: white;
        --paper-input-container-focus-color: white;
        --paper-input-container-label: {
          color: grey;
        }
      }
      .baner_Image{
        --iron-image-width: 100%;
      }
      #donaldHandUp_Image{
        width: 100%;
        margin-top:100px;
        /*padding-top: 40px;
        padding-left: 40px;
        padding-right: 40px;*/
      }
      /*#mainContent{
        background: red;
      }*/
      .greeting{
        font-size: 26pt;
        font-weight: 300;
        margin-left: auto;
        margin-right: auto;
      }
      iron-icon{
        --iron-icon-fill-color:grey;
      }
      @media screen and (max-width: 480px) {
        .xs12{
            margin-left: 0px !important;
            padding: 20px;
        }
        .greeting{
          font-size: 20pt;
        }
      }
      #tweet_picture_holder{
        margin-left: auto;
        margin-right: auto;
        width: 100%;
        display: flex;
        max-width: 700px;
      }
      #trump_tweet{
        width: 100% !important;
        margin-left: 0px;
        margin-right: 0px;
        max-width: none;
      }
    </style>
    <iron-grid xs-max-width="300" s-max-width="650">
      <!--<div class=" s0 m2 americanFlagRed"></div>-->
      <div  class="offset-s0 offset-m1 s12 m10 whiteColor" style="padding-left:0px; padding-right:0px;">
        <iron-image class="baner_Image" style="margin-left:auto; margin-right: auto;" src="../images/png/banner.png" preload ></iron-image>
        <!------Start of twitter stuff------>
        
        <div id="twitterCard" >
          <div class="permalink-inner permalink-tweet-container">
            <iron-grid>
              <div  class="offset-m1 offset-xs0 xs12 m10 ">
                <div class="greeting" style="width: 100%;">
                  <p style="margin-top:80px; max-width: 600px; margin-left:auto; margin-right: auto;">Congratulations, Mr. President. </p>
                  <p style="margin-top: 30px; max-width: 600px; margin-left:auto; margin-right: auto;">You are now the most powerful man in the world. Before you use this tool, <span style="font-weight:400;">you must know that your voice, your words, 
                    and your actions can change our world for the better</span> or for the worse. 
                    So please use it with the care we expect from your office. </p>
                </div>
                <br> 
                <div id="tweet_picture_holder">     
                <div style="margin-top:50px; width:initial;" id="trump_tweet" class=" card tweet permalink-tweet">
                  <div class="content clearfix">
                    <div class="permalink-header">
                      <a class="account-group js-account-group js-action-profile js-user-profile-link js-nav" data-user-id="25073877">
                        <img class="avatar js-action-profile-avatar" src="../images/png/djt_headshot.jpg" alt="">
                        <strong class="fullname js-action-profile-name show-popup-with-id" data-aria-label-part="">Donald J. Trump<iron-image class="Icon" style="position: absolute; margin-left:4px;" src="../images/png/ic_verify.png" ></strong>
                        <span>&rlm;</span><span class="username js-action-profile-name" data-aria-label-part=""><s>@</s><b>realDonaldTrump</b></span>
                      </a>
                      <!--<small class="time">
                          <a  class="tweet-timestamp js-permalink js-nav js-tooltip" title="10:00 AM - 20 Jan 2017" data-conversation-id="822504142178500608"><span class="_timestamp js-short-timestamp js-relative-timestamp" data-time="1484935243" data-time-ms="1484935243000" data-long-form="true" aria-hidden="true">8h</span><span class="u-hiddenVisually" data-aria-label-part="last">8 hours ago</span></a>
                        </small>-->
                      <div class="follow-bar">
                        <div class="user-actions btn-group not-following not-muting  " data-user-id="25073877" data-screen-name="realDonaldTrump"
                          data-name="Donald J. Trump" data-protected="false">
                          <button class="user-actions-follow-button js-follow-btn follow-button btn" type="button">
                          <span class="button-text follow-text" style="margin-top:4px;">
                           <iron-image class="Icon" style="margin-bottom:3px" src="../images/png/follow_icon.png" ></iron-image>Follow 
                            
                          </span>
                          
                        </button>
                      </div>
                    </div>
                  </div>
              </div>
              <div class="js-tweet-text-container">
                <paper-textarea id="input-textArea" label="{{myLabel}}" value="{{userInput}}"></paper-textarea>
              </div>
              <div class="js-tweet-details-fixer tweet-details-fixer">
                <div class="js-machine-translated-tweet-container"></div>
                <div class="js-tweet-stats-container tweet-stats-container">
                  <ul class="stats" aria-label="Retweeted and favorited by">
                    <li class="js-stat-count js-stat-retweets stat-count" aria-hidden="true">
                      <a tabindex="0" role="button" data-tweet-stat-count="10433" data-compact-localized-count="10K" class="request-retweeted-popup"
                        data-activity-popup-title="10,433 retweets">
                        Retweets <strong>10,433</strong>
                        </a>
                    </li>
                    <li class="js-stat-count js-stat-favorites stat-count" aria-hidden="true">
                      <a tabindex="0" role="button" data-tweet-stat-count="54820" data-compact-localized-count="55K" class="request-favorited-popup"
                        data-activity-popup-title="54,820 likes">
                        Likes <strong>54,820</strong>
                        </a>
                    </li>
                    <li class="avatar-row js-face-pile-container">
                      <a class="js-profile-popup-actionable js-tooltip" data-user-id="930429612" original-title="Robert Golden" title="Robert Golden"rel="noopener">
                        <img class="avatar size24 js-user-profile-link" src="../images/png/follower_1.jpeg" alt="Robert Golden">
                      </a>
                        <a class="js-profile-popup-actionable js-tooltip" data-user-id="3084231070" original-title="Wanda Brewington" title="Wanda Brewington"
                          rel="noopener">
                          <img class="avatar size24 js-user-profile-link" src="../images/png/follower_2.png" alt="Wanda Brewington">
                          </a>
                          <a class="js-profile-popup-actionable js-tooltip" data-user-id="755004241383751680" original-title="TrumpPepe2020" title="TrumpPepe2020"
                            rel="noopener">
                            <img class="avatar size24 js-user-profile-link" src="../images/png/follower_3.jpg" alt="TrumpPepe2020">
                            </a>
                            <a class="js-profile-popup-actionable js-tooltip" data-user-id="3303150538" original-title="Thomas Jon IV" title="Thomas Jon IV"
                              rel="noopener">
                              <img class="avatar size24 js-user-profile-link" src="../images/png/follower_4.jpg" alt="Thomas Jon IV">
                              </a>
                              <a class="js-profile-popup-actionable js-tooltip" data-user-id="3439191809" original-title="Zachary Lippincott" title="Zachary Lippincott"
                                rel="noopener">
                                <img class="avatar size24 js-user-profile-link" src="../images/png/follower_5.jpg" alt="Zachary Lippincott">
                                </a>
                                <a class="js-profile-popup-actionable js-tooltip" data-user-id="758491129104834560" original-title="Hillary Diane" title="Hillary Diane"
                                  rel="noopener">
                                  <img class="avatar size24 js-user-profile-link" src="../images/png/follower_6.png" alt="Hillary Diane">
                                  </a>
                                  <a class="js-profile-popup-actionable js-tooltip" data-user-id="822447154182688768" original-title="Sandra Darby" title="Sandra Darby"
                                    rel="noopener">
                                    <img class="avatar size24 js-user-profile-link" src="../images/png/follower_7.png" alt="Sandra Darby">
                                    </a>
                                    <a class="js-profile-popup-actionable js-tooltip" data-user-id="818129288763351040" original-title="Patti Collis" title="Patti Collis"
                                      rel="noopener">
                                      <img class="avatar size24 js-user-profile-link" src="../images/png/follower_8.png" alt="Patti Collis">
                                      </a>
                    </li>
                  </ul>
                </div>
                <div class="client-and-actions">
                  <span class="metadata">
                        <span>10:00 AM - 20 Jan 2017</span>
                  </span>
                </div>
              </div>
              <div class="stream-item-footer">
                <div class="ProfileTweet-actionCountList u-hiddenVisually">
                  <span class="ProfileTweet-action--reply u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="4775">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">4,775 replies</span>
                  </span>
                  </span>
                  <span class="ProfileTweet-action--retweet u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="10433">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">10,433 retweets</span>
                  </span>
                  </span>
                  <span class="ProfileTweet-action--favorite u-hiddenVisually">
                          <span class="ProfileTweet-actionCount" data-tweet-stat-count="54820">
                            <span class="ProfileTweet-actionCountForAria" data-aria-label-part="">54,820 likes</span>
                  </span>
                  </span>
                </div>
                <div class="ProfileTweet-actionList js-actions buffer-inserted pocket-inserted" role="group" aria-label="Tweet actions">
                  <div class="ProfileTweet-action ProfileTweet-action--reply">
                    <button class="ProfileTweet-actionButton u-textUserColorHover js-actionButton js-actionReply" data-modal="ProfileTweet-reply"
                      type="button">
                      <div class="IconContainer js-tooltip" title="Reply">
                        <iron-image class="Icon tweet_bottom_icons" src="../images/png/ic_replypng.png"></iron-image>
                        <span class="u-hiddenVisually">Reply</span>
                      </div>
                      <div class="IconTextContainer">
                        <span class="ProfileTweet-actionCount ">
                              <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">4.8K</span>
                        </span>
                      </div>
                      </button>
                  </div>
                  <div class="ProfileTweet-action ProfileTweet-action--retweet js-toggleState js-toggleRt">
                    <button class="ProfileTweet-actionButton  js-actionButton js-actionRetweet" data-modal="ProfileTweet-retweet" type="button">
                                      <div class="IconContainer js-tooltip" title="Retweet">
                                        <iron-image class="Icon tweet_bottom_icons" src="../images/png/ic_retweetpng.png" ></iron-image>
                                        <span class="u-hiddenVisually">Retweet</span>
                                      </div>
                                        <div class="IconTextContainer">
                                          <span class="ProfileTweet-actionCount">
                                            <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">10K</span>
                                          </span>
                                        </div>
                                    </button>
                  </div>
                  <div class="ProfileTweet-action ProfileTweet-action--favorite js-toggleState">
                    <button class="ProfileTweet-actionButton js-actionButton js-actionFavorite" type="button">
                                      <div class="IconContainer js-tooltip" title="Like"></div>
                                        <div class="IconTextContainer">
                              <iron-image class="Icon tweet_bottom_icons" src="../images/png/ic_likepng.png" ></iron-image>
                              <span class="ProfileTweet-actionCountForPresentation" aria-hidden="true">55K</span>
                          </div>
                      </button>
                  </div>
                </div>
              </div>
          </div>
        </div>
        </div>
        </iron-grid>
        <iron-grid>
          <paper-button id="shareImage-button" on-tap="takePicture" raised class="offset-s2 s8 ">Share your fake tweet.</paper-button>
        </iron-grid>
          <iron-image id="donaldHandUp_Image" class="baner_Image" style="margin-left:auto; margin-right: auto; background: white;" src="../images/png/donald_hand_up.png" ></iron-image>
      </div>
      
      </div>
      
      </div>
      <!--<div class="s0 m2 americanFlagRed"></div>-->
    </iron-grid>
    
    <paper-dialog>
      <h2>Share your image</h2>
      <div id="scrollOutside" style="width:initial; overflow: auto;"><iron-image id="image_preview" style="width:500px; height:260px;" src="{{imageLink}}" preload sizing="contain"></iron-image></div>
      <paper-item >imageUri: {{imageLink}}</paper-item>
      <div id="share_buttons" class="buttons">
        <!--<paper-button dialog-dismiss>Download Image</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>-->
        <paper-button on-tap="downloadImage" style="color:grey;"><iron-icon  icon="icons:file-download" style="margin-right:8px;"></iron-icon> {{downloadText}}</paper-button>
        <paper-button disabled><iron-icon  src="../images/png/ic_twitter.png" style="margin-right:8px;"></iron-icon> {{shareText}}</paper-button>
        <paper-button disabled><iron-icon  src="../images/png/ic_facebook.png" style="margin-right:8px;"></iron-icon> {{shareText}}</paper-button>
      </div>
    </paper-dialog>

    <iron-media-query query="(min-width: 600px)" query-matches="{{mobilePhone}}"></iron-media-query>
  </template>
  <script>
    var globalThis;
    Polymer({

      is: 'my-view1',

      properties: {
        userInput:{
          type: String,
          value:"",
          notify:true,
          observer:"_userInputChange"
        },
        myLabel:{
          type:String,
          value:"Click to start typing...",
          notify:true,
        },
        prop1: {
          type: String,
          value: 'RumpTweets-app',
        },
        user :{
          type:Object,
          value:{}
        },
        imageLink:{
          type:String,
          notify:true,
          value:""
        },
        mobilePhone:{
          type:Boolean,
          notify:true,
          observer: '_mobilePhoneChange'
        },
        hideShareText:{
          type:Boolean,
          notify:true,
          value:false
        },
        shareText:{
          type:String,
          notify:true,
          value:"Share"
        },
        downloadText:{
          type:String,
          notify:true,
          value:"Download"
        }
      },

     
      _userInputChange: function(){
         if(this.userInput==""){
          this.myLabel = "Click to start typing...";
        }else{
          this.myLabel = "";
        }
      },
      //Remove words on download dialog and the margin right based on width of screen
      _mobilePhoneChange: function(newValue,oldValue){
        var allIronImages = Polymer.dom(this.root).querySelectorAll("iron-icon");
        if(newValue==false){
          this.shareText = "";
          this.downloadText = "";
          //get all the iron-icons and remove the paddings
          for(item in allIronImages){
            var ironIconItem = allIronImages[item];
            ironIconItem.style.marginRight = "0px";
          }
        }else{
          this.shareText = "Share";
          this.downloadText = "Download";
          //get all the iron-icons and add the paddings
          for(item in allIronImages){
            var ironIconItem = allIronImages[item];
            ironIconItem.style.marginRight = "4px";
          }
        }

      },
      //Callback when the system is ready
      ready: function () {
        var rootThis = this;
        
        var textArea = Polymer.dom(this.root).querySelector("#input-textArea");
        var donaldTrunpHandUp = Polymer.dom(this.root).querySelector("#donaldHandUp_Image");
        //console.log(donaldTrunpHandUp.shadowRoot);
        var imageContainer = donaldTrunpHandUp.shadowRoot.querySelector("img");
        //console.log(imageContainer);
        imageContainer.style.maxWidth = "800px"; 
        imageContainer.style.marginLeft = "auto";
        imageContainer.style.marginRight = "auto";     
        //console.log(imageContainer.getBoundingClientRect());
        setTimeout(function() {
            firebase.auth().signInAnonymously().catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // ...
          });

          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              // User is signed in.
              var isAnonymous = user.isAnonymous;
              var uid = user.uid;
              rootThis.user = user;
              //console.log(rootThis.user);
              // ...
            } else {
              // User is signed out.
              // ...
            }
            // ...
          });
        }, 500);
        

      },
      //Listners
      
      userTyped: function(){
        console.log("sfaf");
        if(this.userInput==""){
          this.myLabel = "Click to start typing...";
        }else{
          this.myLabel = "";
        }
      },
      //Take the picture and post to server
      takePicture: function () {
        globalThis = this;
        var rootThis = this;
         //get ref to new key
        var newPostKey = firebase.database().ref().child('Posts/'+rootThis.user.uid+'/').push().key;
        var postData = {
          userId: this.user.uid,
          imagePostId:newPostKey,
          message: this.userInput
        };
        this.makeImage(postData);
         //console.log(JSON.stringify(postData));  
      },

      makeImage:function(data){
        var oReq = new XMLHttpRequest();
        oReq.addEventListener("load", this.makeImageReqListener);
        oReq.withCredentials = true;
        oReq.open("POST", "http://localhost:8080/api/gentweet");
        oReq.setRequestHeader("content-type", "application/json");
        //oReq.setRequestHeader("access-control-allow-origin", 'http://localhost:9090*');
        oReq.send(JSON.stringify(data));
      },
      shortenUrl: function(data){
        var oReq = new XMLHttpRequest();
        oReq.addEventListener("load", this.reqListener);
        oReq.open("POST", "https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyAPSrWdW13qN6-YAIrgZO_0F4CHdE2E4d0",true);
        oReq.setRequestHeader('Content-Type', 'application/json');      
        oReq.send(JSON.stringify({"longUrl": data}));
      },
      
      reqListener: function(e) {
        var paperDialog = Polymer.dom(globalThis.root).querySelector("paper-dialog");
        //console.log(this.responseText);
        var temp = JSON.parse(this.responseText);
        globalThis.imageLink = temp.id;
        paperDialog.open();
      },
      makeImageReqListener: function(e) {
        globalThis.shortenUrl(JSON.parse(this.responseText).downloadUrl);
      },
      downloadImage: function(){
        var a = document.createElement("a");
        a.href = this.imageLink;
        a.download = "rump_tweet.png"
        a.click();
      }

    });
  </script>
</dom-module>